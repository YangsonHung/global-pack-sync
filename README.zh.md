# npm-migrate

ğŸš€ Node.js å…¨å±€ npm åŒ…è¿ç§»å·¥å…· - è½»æ¾åœ¨ä¸åŒ Node.js ç‰ˆæœ¬é—´è¿ç§»å…¨å±€å®‰è£…çš„åŒ…

[![npm version](https://badge.fury.io/js/npm-migrate.svg)](https://www.npmjs.com/package/npm-migrate)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## é—®é¢˜èƒŒæ™¯

åœ¨ Node.js å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°è¿™æ ·çš„ç—›ç‚¹ï¼š

- ğŸ”„ Node.js ç‰ˆæœ¬æ›´æ–°é¢‘ç¹ï¼Œéœ€è¦åˆ‡æ¢ç‰ˆæœ¬æµ‹è¯•é¡¹ç›®å…¼å®¹æ€§
- ğŸ“¦ å…¨å±€å®‰è£…çš„ npm åŒ…åœ¨åˆ‡æ¢ Node.js ç‰ˆæœ¬åéœ€è¦é‡æ–°å®‰è£…
- â° æ‰‹åŠ¨è®°ä½å’Œé‡æ–°å®‰è£…å‡ åä¸ªå…¨å±€åŒ…æ—¢è´¹æ—¶åˆå®¹æ˜“é—æ¼
- ğŸ”§ ä¸åŒåŒ…ç®¡ç†å™¨ï¼ˆnpm/yarn/pnpmï¼‰çš„åŒ…æ— æ³•ä¾¿æ·è¿ç§»

**npm-migrate** å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿï¼

## ç‰¹æ€§

âœ¨ **æ™ºèƒ½ç‰ˆæœ¬ç®¡ç†**
- ğŸ†• é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å…å®‰å…¨æ¼æ´
- ğŸ”’ æ”¯æŒé”å®šåˆ°ä¿å­˜æ—¶çš„ç¡®åˆ‡ç‰ˆæœ¬
- ğŸ“Š ç‰ˆæœ¬å˜æ›´å¯è§†åŒ–å±•ç¤º

âš¡ **é«˜æ€§èƒ½å®‰è£…**
- ğŸš€ å¹¶è¡Œå®‰è£…ï¼Œå¤§å¹…æå‡è¿ç§»é€Ÿåº¦
- ğŸ¯ æ™ºèƒ½è·³è¿‡å·²å®‰è£…çš„åŒ…
- ğŸ”„ å¤±è´¥åŒ…è‡ªåŠ¨ç”Ÿæˆé‡è¯•è„šæœ¬

ğŸ›  **å¤šåŒ…ç®¡ç†å™¨æ”¯æŒ**
- ğŸ“¦ npmã€yarnã€pnpm å…¨æ”¯æŒ
- ğŸ” è‡ªåŠ¨æ£€æµ‹å½“å‰ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨
- ğŸ”§ çµæ´»æŒ‡å®šåŒ…ç®¡ç†å™¨

ğŸ¨ **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
- ğŸŒˆ å½©è‰²ç»ˆç«¯è¾“å‡ºï¼Œæ¸…æ™°æ˜“è¯»
- ğŸ“‹ è¯¦ç»†çš„è¿›åº¦å’ŒçŠ¶æ€åé¦ˆ
- ğŸ” äº¤äº’å¼é€‰æ‹©æ€§æ¢å¤
- ğŸ“Š é…ç½®å·®å¼‚å¯¹æ¯”åŠŸèƒ½

ğŸ›¡ **å®‰å…¨ç¨³å®š**
- ğŸ”’ è¿›ç¨‹é”é˜²æ­¢å¹¶å‘å†²çª
- ğŸš« è‡ªåŠ¨è¿‡æ»¤ç³»ç»ŸåŒ…å’Œå·¥å…·æœ¬èº«
- ğŸ’¾ é…ç½®æ–‡ä»¶è‡ªåŠ¨å¤‡ä»½

## å®‰è£…

```bash
# å…¨å±€å®‰è£…
npm install -g npm-migrate

# æˆ–ä½¿ç”¨ yarn
yarn global add npm-migrate

# æˆ–ä½¿ç”¨ pnpm
pnpm add -g npm-migrate
```

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬å·¥ä½œæµç¨‹

```bash
# 1. åœ¨å½“å‰ Node.js ç‰ˆæœ¬ä¿å­˜å…¨å±€åŒ…é…ç½®
npm-migrate save

# 2. åˆ‡æ¢åˆ°æ–°çš„ Node.js ç‰ˆæœ¬
nvm use 18.0.0  # æˆ– n 18.0.0

# 3. æ¢å¤å…¨å±€åŒ…åˆ°æ–°ç¯å¢ƒï¼ˆé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼‰
npm-migrate restore
```

å°±æ˜¯è¿™ä¹ˆç®€å•ï¼ğŸ‰

## å‘½ä»¤è¯¦è§£

### ğŸ“¥ ä¿å­˜é…ç½®

```bash
# ä¿å­˜å½“å‰ç¯å¢ƒçš„å…¨å±€åŒ…åˆ—è¡¨
npm-migrate save

# ä¿å­˜åˆ°æŒ‡å®šé…ç½®åç§°
npm-migrate save my-project-packages

# ä¿å­˜æ—¶ä¼šæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
âœ“ å·²ä¿å­˜é…ç½®æ–‡ä»¶ "node-v18.17.0-1693123456789"
  Node ç‰ˆæœ¬: v18.17.0
  npm ç‰ˆæœ¬: 9.6.7
  åŒ…ç®¡ç†å™¨: npm
  åŒ…æ•°é‡: 15
  ä¿å­˜ä½ç½®: ~/.npm-migrate/packages.json
```

### ğŸ“¤ æ¢å¤é…ç½®

```bash
# æ¢å¤æœ€æ–°ä¿å­˜çš„é…ç½®ï¼ˆä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼‰
npm-migrate restore

# æ¢å¤æŒ‡å®šé…ç½®
npm-migrate restore my-project-packages

# ä½¿ç”¨ä¿å­˜æ—¶çš„ç¡®åˆ‡ç‰ˆæœ¬
npm-migrate restore --exact-version

# æŒ‡å®šåŒ…ç®¡ç†å™¨å’Œå¹¶å‘æ•°
npm-migrate restore --pm yarn --concurrency 5
```

### ğŸ¯ é€‰æ‹©æ€§æ¢å¤

æœ‰æ—¶æ‚¨å¯èƒ½ä¸æƒ³æ¢å¤æ‰€æœ‰åŒ…ï¼Œå¯ä»¥ä½¿ç”¨äº¤äº’å¼é€‰æ‹©ï¼š

```bash
npm-migrate select

# ä¼šæ˜¾ç¤ºå¦‚ä¸‹ç•Œé¢ï¼š
é€‰æ‹©è¦æ¢å¤çš„åŒ… (é…ç½®: node-v18.17.0-1693123456789):

åŒ…åˆ—è¡¨:
  1. @vue/cli@5.0.8
  2. create-react-app@5.0.1
  3. typescript@5.2.2
  4. nodemon@3.0.1
  5. pm2@5.3.0

è¾“å…¥è¦è·³è¿‡çš„åŒ…åºå· (ç”¨ç©ºæ ¼åˆ†éš”ï¼Œç›´æ¥å›è½¦å®‰è£…å…¨éƒ¨):
2 4    # è·³è¿‡ create-react-app å’Œ nodemon

å°†å®‰è£… 3 ä¸ªåŒ…
```

### ğŸ“Š æŸ¥çœ‹å’Œæ¯”è¾ƒé…ç½®

```bash
# åˆ—å‡ºæ‰€æœ‰ä¿å­˜çš„é…ç½®
npm-migrate list

# æ¯”è¾ƒä¸¤ä¸ªé…ç½®çš„å·®å¼‚
npm-migrate diff node-v16.20.0 node-v18.17.0

# å·®å¼‚å¯¹æ¯”è¾“å‡ºç¤ºä¾‹ï¼š
é…ç½®å·®å¼‚å¯¹æ¯”: node-v16.20.0 vs node-v18.17.0

+ @vue/cli@5.0.8 (æ–°å¢)
- create-react-app@4.0.3 (ç§»é™¤)
~ typescript: 4.9.5 â†’ 5.2.2 (ç‰ˆæœ¬å˜æ›´)

ç»Ÿè®¡: æ–°å¢: 1, ç§»é™¤: 1, æ›´æ–°: 3, ç›¸åŒ: 10
```

### ğŸ—‘ åˆ é™¤é…ç½®

```bash
# åˆ é™¤æŒ‡å®šé…ç½®
npm-migrate delete old-config
```

## å‚æ•°é€‰é¡¹

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--pm <manager>` | æŒ‡å®šåŒ…ç®¡ç†å™¨ (npm/yarn/pnpm) | è‡ªåŠ¨æ£€æµ‹ |
| `--concurrency <n>` | å¹¶è¡Œå®‰è£…çš„åŒ…æ•°é‡ | 3 |
| `--exact-version` | ä½¿ç”¨ä¿å­˜æ—¶çš„ç¡®åˆ‡ç‰ˆæœ¬ | false (ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬) |

## é«˜çº§ç”¨æ³•

### ğŸ”§ å›¢é˜Ÿåä½œ

åœ¨å›¢é˜Ÿé¡¹ç›®ä¸­ï¼Œå¯ä»¥å°†é…ç½®æ–‡ä»¶åŠ å…¥ç‰ˆæœ¬æ§åˆ¶ï¼š

```bash
# ä¿å­˜å›¢é˜Ÿæ ‡å‡†é…ç½®
npm-migrate save team-standard

# å›¢é˜Ÿæˆå‘˜åˆ‡æ¢ Node.js ç‰ˆæœ¬å
npm-migrate restore team-standard
```

### ğŸš€ CI/CD é›†æˆ

```yaml
# .github/workflows/test.yml
steps:
  - name: Setup Node.js
    uses: actions/setup-node@v3
    with:
      node-version: '18'

  - name: Restore global packages
    run: |
      npm install -g npm-migrate
      npm-migrate restore ci-packages
```

### ğŸ“ é…ç½®æ–‡ä»¶ç®¡ç†

é…ç½®æ–‡ä»¶é»˜è®¤ä¿å­˜åœ¨ `~/.npm-migrate/packages.json`ï¼š

```json
{
  "node-v18.17.0-1693123456789": {
    "nodeVersion": "v18.17.0",
    "npmVersion": "9.6.7",
    "packageManager": "npm",
    "packages": {
      "@vue/cli": "5.0.8",
      "typescript": "5.2.2"
    },
    "savedAt": "2023-08-27T10:30:56.789Z",
    "packagesCount": 15,
    "platform": "darwin",
    "arch": "x64"
  }
}
```

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬è€Œä¸æ˜¯ä¿å­˜æ—¶çš„ç‰ˆæœ¬ï¼Ÿ

A: ä¸ºäº†å®‰å…¨è€ƒè™‘ã€‚æœ€æ–°ç‰ˆæœ¬é€šå¸¸åŒ…å«å®‰å…¨ä¿®å¤å’Œ bug ä¿®å¤ã€‚å¦‚æœéœ€è¦ç¡®åˆ‡ç‰ˆæœ¬ï¼Œå¯ä½¿ç”¨ `--exact-version` å‚æ•°ã€‚

### Q: å“ªäº›åŒ…ä¼šè¢«è‡ªåŠ¨è¿‡æ»¤ï¼Ÿ

A: å·¥å…·ä¼šè‡ªåŠ¨è¿‡æ»¤ä»¥ä¸‹åŒ…ï¼Œé¿å…å†²çªï¼š
- `npm`ã€`npx` - npm æ ¸å¿ƒå·¥å…·
- `corepack` - Node.js å†…ç½®åŒ…ç®¡ç†å™¨
- `node-gyp` - é€šå¸¸ä¼šè‡ªåŠ¨å®‰è£…
- `npm-migrate` - å·¥å…·æœ¬èº«

### Q: å®‰è£…å¤±è´¥çš„åŒ…æ€ä¹ˆå¤„ç†ï¼Ÿ

A: å·¥å…·ä¼šè‡ªåŠ¨ç”Ÿæˆé‡è¯•è„šæœ¬ `~/.npm-migrate/retry-failed.sh`ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œæˆ–ä¿®æ”¹åæ‰§è¡Œã€‚

### Q: æ”¯æŒç§æœ‰ npm æºå—ï¼Ÿ

A: æ˜¯çš„ï¼Œå·¥å…·ä½¿ç”¨å½“å‰ç¯å¢ƒçš„ npm é…ç½®ï¼ŒåŒ…æ‹¬ç§æœ‰æºé…ç½®ã€‚

### Q: å¯ä»¥åœ¨ä¸åŒæ“ä½œç³»ç»Ÿé—´è¿ç§»å—ï¼Ÿ

A: å¤§éƒ¨åˆ†åŒ…å¯ä»¥ï¼Œä½†ä¸€äº›ä¾èµ–åŸç”Ÿæ¨¡å—çš„åŒ…å¯èƒ½éœ€è¦é‡æ–°ç¼–è¯‘ã€‚å·¥å…·ä¼šä¿å­˜å¹³å°ä¿¡æ¯ä¾›å‚è€ƒã€‚

## æ•…éšœæ’æŸ¥

### æƒé™é—®é¢˜

```bash
# macOS/Linux
sudo npm-migrate restore

# æˆ–è€…ä¿®å¤ npm æƒé™
npm config set prefix ~/.npm-global
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.profile
```

### ç½‘ç»œé—®é¢˜

```bash
# è®¾ç½® npm æº
npm config set registry https://registry.npmmirror.com

# æˆ–ä¸´æ—¶ä½¿ç”¨
npm-migrate restore --pm npm
```

### æ¸…ç†å’Œé‡ç½®

```bash
# æ¸…ç†é…ç½®æ–‡ä»¶
rm -rf ~/.npm-migrate

# é‡æ–°å¼€å§‹
npm-migrate save
```

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·æŸ¥çœ‹ [CONTRIBUTING.md](./CONTRIBUTING.md) äº†è§£è¯¦æƒ…ã€‚

### å¼€å‘ç¯å¢ƒæ­å»º

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-username/npm-migrate.git
cd npm-migrate

# å®‰è£…ä¾èµ–
npm install

# æœ¬åœ°æµ‹è¯•
node index.js --help

# è¿è¡Œæµ‹è¯•
npm test
```

## æ›´æ–°æ—¥å¿—

### v2.0.0 (æœ€æ–°)
- âœ¨ æ–°å¢é€‰æ‹©æ€§æ¢å¤åŠŸèƒ½
- ğŸ†• é»˜è®¤ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ç­–ç•¥
- ğŸš€ æ”¯æŒå¹¶è¡Œå®‰è£…æå‡æ€§èƒ½
- ğŸ“Š å¢åŠ é…ç½®å·®å¼‚å¯¹æ¯”
- ğŸ›  æ”¯æŒå¤šåŒ…ç®¡ç†å™¨ (yarn/pnpm)
- ğŸ”’ å¢åŠ è¿›ç¨‹é”é˜²æ­¢å†²çª

### v1.0.0
- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ“¦ åŸºç¡€çš„ä¿å­˜å’Œæ¢å¤åŠŸèƒ½
- ğŸ’¾ JSON é…ç½®æ–‡ä»¶å­˜å‚¨

æŸ¥çœ‹å®Œæ•´æ›´æ–°æ—¥å¿—ï¼š[CHANGELOG.md](./CHANGELOG.md)

## è®¸å¯è¯

[MIT License](./LICENSE) Â© 2023

## é“¾æ¥

- ğŸ  [é¡¹ç›®ä¸»é¡µ](https://github.com/your-username/npm-migrate)
- ğŸ› [é—®é¢˜åé¦ˆ](https://github.com/your-username/npm-migrate/issues)
- ğŸ“– [Wiki æ–‡æ¡£](https://github.com/your-username/npm-migrate/wiki)
- ğŸ’¬ [è®¨è®ºåŒº](https://github.com/your-username/npm-migrate/discussions)

---

å¦‚æœè¿™ä¸ªå·¥å…·å¸®åŠ©åˆ°äº†æ‚¨ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª â­ Starï¼

**å¿«ä¹ç¼–ç ï¼** ğŸ‰